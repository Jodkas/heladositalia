<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--Meta mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--Sheet description-->
    <title>Helados Italia</title>
    <meta name="author" content="Lucas Cardozo" />
    <meta
      name="description"
      content="Entra y podrás realizar tu pedido de helado a cualquiera de nuestras sucursales! No te arrepentirás..."
    />
    <!--Styles CSS-->
    <link rel="shortcut icon" href="Images/Logo/Logo_Italia.svg" />
    <link rel="stylesheet" href="Css/normalize.css" />
    <link rel="stylesheet" href="Css/style.css" />
    <!--<link rel="stylesheet" href="chargeStyle.css" />-->
    <link rel="stylesheet" href="Css/shopStyle.css" />
  </head>
  <body id="body" class="block-scroll">
    <audio src="Audio/Music.mp3" loop class="audio"></audio>
    <nav class="nav">
      <div class="nav__background"></div>
      <div class="flavors__container">
        <div class="flavors__ul-container"></div>
        <div class="flavors__button">Agregar</div>
      </div>
      <div class="cart">
        <h2 class="cart__titulo"><i>Pedido</i></h2>
        <ul class="cart__ul"></ul>
        <div class="cart__total">
          <div class="cart__total-send-price">
            <p class="cart__total-send-price-p">
              Envío: $<span class="cart__total-send-price-text"></span>
            </p>
          </div>
          <div class="cart__total-price">
            <p class="cart__total-price-p">
              Total a pagar: $<span class="cart__total-price-text"></span>
            </p>
          </div>
        </div>
      </div>
      <script>
        let A = [-57.572019, -38.019065];
        let B = [-57.545151, -37.985564];
        let C = [-57.520518, -38.016336];
        let D = [-57.545012, -38.039945];

        let sumAngulos;
        const poligono = [A, B, C, D];
        function check(poligono, punto) {
          let vector1;
          let vector2;
          const Px = punto[0];
          const Py = punto[1];
          sumAngulos = 0;
          for (let i = 0; i < poligono.length; i++) {
            let Ax = poligono[i][0];
            let Ay = poligono[i][1];
            let Bx;
            let By;
            vector1 = poligono[i];
            i + 1 == poligono.length
              ? ((vector2 = poligono[0]),
                (Bx = poligono[0][0]),
                (By = poligono[0][1]))
              : ((vector2 = poligono[i + 1]),
                (Bx = poligono[i + 1][0]),
                (By = poligono[i + 1][1]));
            let M = [Ax - Px, Ay - Py];
            let N = [Bx - Px, By - Py];
            let prodEscalar = M[0] * N[0] + M[1] * N[1];
            let moduloM = Math.sqrt(Math.pow(M[0], 2) + Math.pow(M[1], 2));
            let moduloN = Math.sqrt(Math.pow(N[0], 2) + Math.pow(N[1], 2));
            sumAngulos =
              sumAngulos +
              (Math.acos(prodEscalar / (moduloM * moduloN)) * 180) / Math.PI;
            console.log({
              vuelta: i + 1,
              paresUsados: Ax + " " + Ay + " " + "/" + Bx + " " + By,
              M: M,
              N: N,
              productoEscalarMN: prodEscalar,
              moduloM: moduloM,
              moduloN: moduloN,
              cosAngulo: prodEscalar / (moduloM * moduloN),
              angulo:
                (Math.acos(prodEscalar / (moduloM * moduloN)) * 180) / Math.PI,
              sumaDeLosAngulos: sumAngulos,
            });
          }
          console.log("Respuesta: ", sumAngulos <= 361 && sumAngulos >= 359);
          return sumAngulos <= 361 && sumAngulos >= 359;
        }

        function validarDireccion() {
          let geocoder = new google.maps.Geocoder();
          let direccion =
            direction.value + height.value + " mar del plata argentina";

          return new Promise((res, rej) => {
            geocoder.geocode(
              {
                address: direccion,
              },
              function (result, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                  let latitud = result[0].geometry.location.lat();
                  let longitud = result[0].geometry.location.lng();
                  console.log(result);
                  console.dir(result);
                  console.log({
                    direccion: direccion,
                    latitud: latitud,
                    longitud: longitud,
                  });
                  console.log(result[0].types[0]);
                  if (
                    result[0].types[0] != "street_address" &&
                    result[0].types[0] != "premise" &&
                    result[0].types[0] != "subpremise"
                  )
                    rej("La direccion indicada no existe!");
                  else if (check(poligono, [longitud, latitud])) {
                    res(true);
                  } else rej("No llegamos hasta ese domicilio! Mil disculpas.");
                } else {
                  rej("La direccion indicada no existe!");
                }
              }
            );
          });
        }
        //tomar valores y lso envia al wsp
        function getData(event) {
          event.preventDefault();
          if (pay.value < totalPrice + shippingPrice) {
            pay.style = "border-color: red";
            alert(
              `El monto a pagar debe ser igual o superior a: $${
                totalPrice + shippingPrice
              }`
            );
            setTimeout(() => {
              pay.style = "border-color: -internal-light-dark(black, white)";
            }, 900);
            return;
          }
          if (house.checked == false) {
            orderComplete = `*Dirección:*\n${direction.value} ${
              height.value
            }\n*Piso:*\n${floor.value}\n*Teléfono:*\n${
              phone.value
            }\n*Pedido:*\n${order}_Costo de envío:_ $${shippingPrice}\n_Cant. Articulos:_ ${
              cartAccountant.textContent
            }\n*Total del pedido:* $${
              totalPrice + shippingPrice
            }\n*Abona con:* $${pay.value}`;
          } else {
            orderComplete = `*Dirección:*\n${direction.value} ${
              height.value
            } (Casa)\n*Teléfono:*\n${
              phone.value
            }\n*Pedido:*\n${order}_Costo de envío:_ $${shippingPrice}\n_Cant. Articulos:_ ${
              cartAccountant.textContent
            }\n*Total del pedido:* $${
              totalPrice + shippingPrice
            }\n*Abona con:* $${pay.value}`;
          }
          let valError;
          validarDireccion()
            .then((e) => {
              if (valError !== false) {
                orderComplete = encodeURI(orderComplete);
                location.assign(
                  `https://wa.me/+5492235433159?text=${orderComplete}`
                );
              }
            })
            .catch((error) => {
              alert(error);
            });
        }
      </script>
      <form class="form" onsubmit="getData(event)">
        <ul class="form__ul">
          <li class="form__li">
            <label
              ><h4>Dirección</h4>
              <input
                type="text"
                id="direction"
                name="direction"
                placeholder="Su dirección"
                required
              />
            </label>
          </li>
          <li class="form__li">
            <label
              ><h4>Altura</h4>
              <input
                id="height"
                type="number"
                name="height"
                placeholder="Altura de su calle"
                required
              />
            </label>
          </li>
          <li class="form__li" id="homeContainer">
            <label
              ><input
                type="radio"
                name="house-department"
                value="house"
                id="house"
                required
              />Casa</label
            >
            <label
              ><input
                type="radio"
                name="house-department"
                value="department"
                id="department"
                required
              />Departamento</label
            >
          </li>
          <li class="form__li" id="floorContainer" style="display: none">
            <label>
              <h4>Piso</h4>
              <input
                type="text"
                id="floor"
                name="floor"
                placeholder="Su piso"
              />
            </label>
          </li>
          <li class="form__li">
            <label
              ><h4>Número de teléfono</h4>
              <input
                type="tel"
                name="phone"
                id="phone"
                placeholder="Su número de teléfono"
                required
              />
            </label>
          </li>
          <li class="form__li">
            <label
              ><h4>Con cuanto abona?</h4>
              <input
                type="number"
                id="pay"
                name="pay"
                placeholder="Monto"
                required
              />
            </label>
          </li>
        </ul>
        <div class="form__li-sendForm">
          <input type="submit" class="sendForm" id="sendForm" value="enviar" />
        </div>
      </form>
      <div class="send" style="display: none">
        <div class="send__container">
          <div class="send__price">
            <div class="send__img-container">
              <img
                class="send__img"
                src="Images/Logo/Logo_wsp.svg"
                alt="Logo de Wsp"
              />
            </div>
            <div class="send__total">
              <b>$</b><b class="send__total-text">0</b>
              <div class="send__priceDelivery">
                <b class="send__priceDelivery-text">0</b>
              </div>
            </div>
          </div>
          <div class="send__text">
            <p>Terminar pedido</p>
          </div>
        </div>
      </div>
      <div class="nav__container">
        <div class="nav__logo">
          <img
            class="nav__img"
            src="Images/Logo/Logo_Italia.svg"
            alt="Logo de Helados Italia"
          />
        </div>
        <div class="nav__icons-container">
          <div class="nav__cart-container">
            <div class="nav__cart">
              <img
                class="nav__cart-img"
                src="Images/Icon/Carrito_icono.svg"
                alt="Icono de carrito en SVG"
              />
              <div class="nav__cart-accountant">
                <p><b class="nav__cart-accountant-text"></b></p>
              </div>
            </div>
          </div>
          <div class="nav__menu-container">
            <div class="nav__menu">
              <img
                class="nav__menu-img"
                src="Images/Icon/menu.svg"
                alt="Icono de menú en SVG"
              />
            </div>
            <div class="nav__menu-banner">
              <ul class="nav__menu-ul">
                <li class="nav__menu-li beginning-button">Inicio</li>
                <li class="nav__menu-li flavors-button">Sabores</li>
                <li class="nav__menu-li local-button">Locales</li>
                <li class="nav__menu-li order-button">Pedido</li>
                <li class="nav__menu-li history-button">Historia</li>
              </ul>
              <div class="nav__menu-networks">
                <div class="nav__menu-networks-img-container">
                  <img
                    class="nav__menu-networks-img instagramLink"
                    src="Images/Icon/instagram_icon.svg"
                    alt="Logo Instagram-svg"
                  />
                </div>
                <div class="nav__menu-networks-img-container">
                  <img
                    class="nav__menu-networks-img facebookLink"
                    src="Images/Icon/facebook_icon.svg"
                    alt="Logo Facebook-svg"
                  />
                </div>
                <div class="nav__menu-networks-img-container">
                  <img
                    class="nav__menu-networks-img whatsappLink"
                    src="Images/Icon/whatsapp_icon.svg"
                    alt="Logo Whatsapp-svg"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <main id="main">
      <section class="banner">
        <video
          class="banner__video"
          loop
          playsinline
          autoplay
          muted
          src="Video/sambayon.mp4"
        ></video>

        <div class="icon-arrow">
          <a class="icon-arrow__a" href="#hr"
            ><img
              class="icon-arrow__img"
              src="Images/Icon/Arrow_white.svg"
              alt="Flecha hacia abajo"
          /></a>
        </div>
        <div class="banner__title">
          <h1 class="banner__h1">Provare per credere</h1>
          <p class="banner__p">-desde 1972-</p>
        </div>
        <div class="icon-audio">
          <img
            class="icon-audio__img-muted"
            src="Images/Icon/Muted.svg"
            alt="Icono de sonido muteado en SVG"
          />
          <img
            class="icon-audio__img-unmuted icon-audio__img-oculted"
            src="Images/Icon/Unmuted.svg"
            alt="Icono de sonido en SVG"
          />
        </div>
      </section>
      <hr id="hr" />
      <div class="information-container">
        <section class="order-container">
          <section>
            <!--Solucion para cargar flecha hacia abajo al recargar pagina-->
            <img
              src="Images/Icon/Arrow_black.svg"
              alt=""
              style="display: none"
            />
          </section>
          <section class="local">
            <div class="local__title">
              <h2>SUCURSALES</h2>
              <p>Elige la mejor para ti</p>
            </div>
            <div class="local__container"></div>
          </section>
          <section class="shop"></section>
        </section>
      </div>
    </main>
    <footer id="footer">
      <h4>Gracias por visitarnos</h4>
      <p>Derechos reservados</p>
    </footer>
    <!--JavaScript-->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjLIWekmnFEjAGRPkzpekF-GmVPen2haQ"></script>
    <script src="Js/createVar.js"></script>
    <script src="Js/charge.js"></script>
    <script src="Js/shopCreate.js"></script>
    <script src="Js/functions.js"></script>
    <script src="Js/nav.js"></script>
    <script src="Js/netwotksLinks.js"></script>
    <script>
      window.onload = function () {
        closeCharge();
        console.log("DOM cargado");
      };
    </script>
  </body>
</html>
